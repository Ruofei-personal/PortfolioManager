<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Manager</title>
    <meta
      name="description"
      content="Portfolio Manager helps you track holdings, visualize allocation, and manage investments with ease."
    />
    <meta name="theme-color" content="#0b0f1a" />
    <meta property="og:title" content="Portfolio Manager" />
    <meta
      property="og:description"
      content="Track holdings, visualize allocation, and manage investments with ease."
    />
    <meta property="og:type" content="website" />
    <meta property="og:locale" content="zh_CN" />
    <meta property="og:site_name" content="Portfolio Manager" />
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="Portfolio Manager" />
    <meta
      name="twitter:description"
      content="Track holdings, visualize allocation, and manage investments with ease."
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link rel="stylesheet" href="/static/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js" defer></script>
  </head>
  <body>
    <div class="ambient"></div>
    <div class="app-shell" id="app">
      <header class="topbar">
        <div class="brand">
          <span class="brand-icon">â—†</span>
          <div>
            <p class="brand-title">{{ t("brandTitle") }}</p>
            <p class="brand-subtitle">{{ t("brandSubtitle") }}</p>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="ghost-btn" type="button" @click="toggleLocale">
            {{ localeLabel }}
          </button>
          <button class="ghost-btn" type="button" @click="logout" v-if="isAuthed">
            {{ t("logout") }}
          </button>
        </div>
      </header>
      <div
        class="notice"
        v-if="notice.message"
        :class="notice.type"
        role="status"
        aria-live="polite"
      >
        {{ notice.message }}
      </div>

      <main>
        <section class="auth" v-if="!isAuthed">
          <div class="auth-card">
            <h1>{{ t("welcomeBack") }}</h1>
            <p>{{ t("welcomeSubtitle") }}</p>
            <form @submit.prevent="login">
              <label>
                {{ t("email") }}
                <input
                  v-model="loginForm.email"
                  type="email"
                  :placeholder="t('emailPlaceholder')"
                  autocomplete="email"
                  required
                />
              </label>
              <label>
                {{ t("password") }}
                <input
                  v-model="loginForm.password"
                  type="password"
                  :placeholder="t('passwordPlaceholder')"
                  autocomplete="current-password"
                  required
                />
              </label>
              <button type="submit" class="primary-btn" :disabled="isLoading.login">
                {{ isLoading.login ? t("loading") : t("login") }}
              </button>
            </form>
            <div class="divider">{{ t("or") }}</div>
            <form @submit.prevent="register">
              <label>
                {{ t("email") }}
                <input
                  v-model="registerForm.email"
                  type="email"
                  :placeholder="t('emailPlaceholder')"
                  autocomplete="email"
                  required
                />
              </label>
              <label>
                {{ t("password") }}
                <input
                  v-model="registerForm.password"
                  type="password"
                  :placeholder="t('passwordMinPlaceholder')"
                  autocomplete="new-password"
                  minlength="6"
                  required
                />
              </label>
              <button type="submit" class="secondary-btn" :disabled="isLoading.register">
                {{ isLoading.register ? t("loading") : t("createAccount") }}
              </button>
            </form>
            <p class="hint">{{ t("dataHint") }}</p>
          </div>
          <div class="auth-visual">
            <div class="glass-card">
              <h2>{{ t("visualTitle") }}</h2>
              <p>{{ t("visualSubtitle") }}</p>
              <ul>
                <li>{{ t("visualFeatureOne") }}</li>
                <li>{{ t("visualFeatureTwo") }}</li>
                <li>{{ t("visualFeatureThree") }}</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="dashboard" v-else>
          <div class="dashboard-grid">
            <div class="panel">
              <div class="panel-header">
                <h2>{{ t("overviewTitle") }}</h2>
                <p>{{ t("greeting", { email: userEmail }) }}</p>
              </div>
              <div class="chart-wrapper">
                <canvas id="portfolioChart" height="280"></canvas>
              </div>
              <div class="stats">
                <div>
                  <span>{{ t("statAssets") }}</span>
                  <strong>{{ stats.assetCount }}</strong>
                </div>
                <div>
                  <span>{{ t("statTotalCost") }}</span>
                  <strong>{{ stats.totalCost }}</strong>
                </div>
                <div>
                  <span>{{ t("statAverageCost") }}</span>
                  <strong>{{ stats.averageCost }}</strong>
                </div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-header">
                <h2>{{ t("formTitle") }}</h2>
                <p>{{ t("formSubtitle") }}</p>
              </div>
              <form class="asset-form" @submit.prevent="saveAsset">
                <label>
                  {{ t("assetName") }}
                  <input
                    v-model="assetForm.name"
                    type="text"
                    :placeholder="t('assetNamePlaceholder')"
                    required
                  />
                </label>
                <label>
                  {{ t("category") }}
                  <select v-model="assetForm.category" required>
                    <option v-for="option in categories" :key="option.value" :value="option.value">
                      {{ t(option.labelKey) }}
                    </option>
                  </select>
                </label>
                <label>
                  {{ t("quantity") }}
                  <input v-model.number="assetForm.quantity" type="number" min="1" step="1" required />
                </label>
                <label>
                  {{ t("totalCost") }}
                  <input v-model.number="assetForm.cost" type="number" min="0" step="0.01" required />
                </label>
                <button type="submit" class="primary-btn" :disabled="isLoading.save">
                  {{ isLoading.save ? t("saving") : t("saveAsset") }}
                </button>
              </form>
            </div>
          </div>

          <div class="panel table-panel" aria-live="polite">
            <div class="panel-header">
              <h2>{{ t("tableTitle") }}</h2>
              <p>{{ t("tableSubtitle") }}</p>
            </div>
            <div class="table" v-if="portfolio.length" role="table" aria-label="Holdings">
              <div class="asset-row" v-for="asset in portfolio" :key="asset.id">
                <div>
                  <div class="asset-name">{{ asset.name }}</div>
                  <div class="asset-tags">
                    <span class="badge">{{ t("category") }} {{ categoryLabel(asset.category) }}</span>
                    <span class="badge badge-muted">
                      {{ t("avgCostLabel", { value: currency(asset.totalCost / asset.quantity) }) }}
                    </span>
                  </div>
                </div>
                <div>
                  <header>{{ t("quantity") }}</header>
                  <div>{{ asset.quantity }}</div>
                </div>
                <div>
                  <header>{{ t("statTotalCost") }}</header>
                  <div>{{ currency(asset.totalCost) }}</div>
                </div>
                <div>
                  <header>{{ t("costPerShare") }}</header>
                  <div>{{ currency(asset.totalCost / asset.quantity) }}</div>
                </div>
                <div>
                  <header>{{ t("category") }}</header>
                  <div>{{ categoryLabel(asset.category) }}</div>
                </div>
                <div>
                  <button
                    class="delete-btn"
                    @click="deleteAsset(asset.id)"
                    :disabled="isLoading.deletingId === asset.id"
                  >
                    {{ isLoading.deletingId === asset.id ? t("deleting") : t("delete") }}
                  </button>
                </div>
              </div>
            </div>
            <div class="empty-state" v-else role="status">{{ t("emptyState") }}</div>
          </div>
        </section>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js" defer></script>
    <script src="/static/app.js" defer></script>
  </body>
</html>
