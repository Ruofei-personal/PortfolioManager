<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portfolio Manager</title>
    <link rel="stylesheet" href="/static/styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>
  <body>
    <div class="ambient"></div>
    <div class="app-shell" id="app">
      <header class="topbar">
        <div class="brand">
          <span class="brand-icon">â—†</span>
          <div>
            <p class="brand-title">{{ t("brandTitle") }}</p>
            <p class="brand-subtitle">{{ t("brandSubtitle") }}</p>
          </div>
        </div>
        <div class="topbar-actions">
          <button class="ghost-btn" @click="toggleLocale">{{ localeLabel }}</button>
          <button class="ghost-btn" @click="logout" v-if="isAuthed">{{ t("logout") }}</button>
        </div>
      </header>

      <main>
        <section class="auth" v-if="!isAuthed">
          <div class="auth-card">
            <h1>{{ t("welcomeBack") }}</h1>
            <p>{{ t("welcomeSubtitle") }}</p>
            <form @submit.prevent="login">
              <label>
                {{ t("email") }}
                <input
                  v-model="loginForm.email"
                  type="email"
                  :placeholder="t('emailPlaceholder')"
                  required
                />
              </label>
              <label>
                {{ t("password") }}
                <input
                  v-model="loginForm.password"
                  type="password"
                  :placeholder="t('passwordPlaceholder')"
                  required
                />
              </label>
              <button type="submit" class="primary-btn">{{ t("login") }}</button>
            </form>
            <div class="divider">{{ t("or") }}</div>
            <form @submit.prevent="register">
              <label>
                {{ t("email") }}
                <input
                  v-model="registerForm.email"
                  type="email"
                  :placeholder="t('emailPlaceholder')"
                  required
                />
              </label>
              <label>
                {{ t("password") }}
                <input
                  v-model="registerForm.password"
                  type="password"
                  :placeholder="t('passwordMinPlaceholder')"
                  minlength="6"
                  required
                />
              </label>
              <button type="submit" class="secondary-btn">{{ t("createAccount") }}</button>
            </form>
            <p class="hint">{{ t("dataHint") }}</p>
          </div>
          <div class="auth-visual">
            <div class="glass-card">
              <h2>{{ t("visualTitle") }}</h2>
              <p>{{ t("visualSubtitle") }}</p>
              <ul>
                <li>{{ t("visualFeatureOne") }}</li>
                <li>{{ t("visualFeatureTwo") }}</li>
                <li>{{ t("visualFeatureThree") }}</li>
              </ul>
            </div>
          </div>
        </section>

        <section class="dashboard" v-else>
          <div class="dashboard-grid">
            <div class="panel">
              <div class="panel-header">
                <h2>{{ t("overviewTitle") }}</h2>
                <p>{{ t("greeting", { email: userEmail }) }}</p>
              </div>
              <div class="chart-wrapper">
                <canvas id="portfolioChart" height="280"></canvas>
              </div>
              <div class="stats">
                <div>
                  <span>{{ t("statAssets") }}</span>
                  <strong>{{ stats.assetCount }}</strong>
                </div>
                <div>
                  <span>{{ t("statTotalCost") }}</span>
                  <strong>{{ stats.totalCost }}</strong>
                </div>
                <div>
                  <span>{{ t("statAverageCost") }}</span>
                  <strong>{{ stats.averageCost }}</strong>
                </div>
              </div>
            </div>

            <div class="panel">
              <div class="panel-header">
                <h2>{{ t("formTitle") }}</h2>
                <p>{{ t("formSubtitle") }}</p>
              </div>
              <form class="asset-form" @submit.prevent="saveAsset">
                <label>
                  {{ t("assetName") }}
                  <input
                    v-model="assetForm.name"
                    type="text"
                    :placeholder="t('assetNamePlaceholder')"
                    required
                  />
                </label>
                <label>
                  {{ t("category") }}
                  <select v-model="assetForm.category" required>
                    <option v-for="option in categories" :key="option.value" :value="option.value">
                      {{ t(option.labelKey) }}
                    </option>
                  </select>
                </label>
                <label>
                  {{ t("quantity") }}
                  <input v-model.number="assetForm.quantity" type="number" min="1" step="1" required />
                </label>
                <label>
                  {{ t("totalCost") }}
                  <input v-model.number="assetForm.cost" type="number" min="0" step="0.01" required />
                </label>
                <button type="submit" class="primary-btn">{{ t("saveAsset") }}</button>
              </form>
            </div>
          </div>

          <div class="panel table-panel">
            <div class="panel-header">
              <h2>{{ t("tableTitle") }}</h2>
              <p>{{ t("tableSubtitle") }}</p>
            </div>
            <div class="table" v-if="portfolio.length">
              <div class="asset-row" v-for="asset in portfolio" :key="asset.id">
                <div>
                  <div class="asset-name">{{ asset.name }}</div>
                  <div class="asset-tags">
                    <span class="badge">{{ t("category") }} {{ categoryLabel(asset.category) }}</span>
                    <span class="badge badge-muted">
                      {{ t("avgCostLabel", { value: currency(asset.totalCost / asset.quantity) }) }}
                    </span>
                  </div>
                </div>
                <div>
                  <header>{{ t("quantity") }}</header>
                  <div>{{ asset.quantity }}</div>
                </div>
                <div>
                  <header>{{ t("statTotalCost") }}</header>
                  <div>{{ currency(asset.totalCost) }}</div>
                </div>
                <div>
                  <header>{{ t("costPerShare") }}</header>
                  <div>{{ currency(asset.totalCost / asset.quantity) }}</div>
                </div>
                <div>
                  <header>{{ t("category") }}</header>
                  <div>{{ categoryLabel(asset.category) }}</div>
                </div>
                <div>
                  <button class="delete-btn" @click="deleteAsset(asset.id)">{{ t("delete") }}</button>
                </div>
              </div>
            </div>
            <div class="empty-state" v-else>{{ t("emptyState") }}</div>
          </div>
        </section>
      </main>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/vue@3/dist/vue.global.prod.js"></script>
    <script src="/static/app.js"></script>
  </body>
</html>
